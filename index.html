<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAP Protocol</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 24px;
            border-bottom: 1px solid #1a1a1a;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .collapse-btn {
            width: 32px;
            height: 32px;
            border: 1px solid #333;
            border-radius: 8px;
            background: transparent;
            color: #666;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .collapse-btn:hover {
            border-color: #555;
            color: #888;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
        }
        
        .logo-icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        .plus-btn {
            width: 32px;
            height: 32px;
            border: 1px solid #333;
            border-radius: 8px;
            background: transparent;
            color: #666;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .plus-btn:hover {
            border-color: #555;
            color: #888;
            background: rgba(255, 255, 255, 0.05);
        }
        
        /* Ticker */
        .ticker {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 8px 16px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 8px;
            font-size: 14px;
            color: #888;
            min-width: 200px;
        }
        
        .ticker-metric {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .ticker-metric:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .ticker-metric.active {
            background: rgba(102, 126, 234, 0.2);
            color: #667eea;
        }
        
        /* Main Chat Area */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            padding: 24px;
        }
        
        .chat-messages {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 24px;
            overflow-y: auto;
        }
        
        .message {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .message.user {
            align-items: flex-end;
        }
        
        .message.ai {
            align-items: flex-start;
        }
        
        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 15px;
            line-height: 1.5;
        }
        
        .message.user .message-content {
            background: #667eea;
            color: white;
        }
        
        .message.ai .message-content {
            background: #1a1a1a;
            color: #ffffff;
            border: 1px solid #333;
        }
        
        .message-time {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }
        
        /* Chat Input */
        .chat-input-container {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            transition: all 0.2s ease;
        }
        
        .chat-input-container:focus-within {
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }
        
        .chat-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #ffffff;
            font-size: 15px;
            outline: none;
            resize: none;
            min-height: 20px;
            max-height: 120px;
        }
        
        .chat-input::placeholder {
            color: #666;
        }
        
        .send-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: #667eea;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .send-btn:hover {
            background: #5a6fd8;
        }
        
        .send-btn:disabled {
            background: #333;
            cursor: not-allowed;
        }
        
        /* Popup */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .popup {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .popup-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        
        .popup-title {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
        }
        
        .popup-close {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            color: #666;
            cursor: pointer;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .popup-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* Footer */
        .footer {
            padding: 16px 24px;
            border-top: 1px solid #1a1a1a;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }
        
        .footer-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 24px;
            font-size: 14px;
            color: #666;
        }
        
        .footer-link {
            color: #888;
            text-decoration: none;
            transition: color 0.2s ease;
        }
        
        .footer-link:hover {
            color: #ffffff;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header {
                padding: 12px 16px;
            }
            
            .chat-container {
                padding: 16px;
            }
            
            .ticker {
                min-width: 150px;
                font-size: 12px;
            }
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message {
            animation: fadeIn 0.3s ease;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <button class="collapse-btn" onclick="toggleSidebar()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>
            
            <div class="logo">
                <div class="logo-icon">üåç</div>
                <span>SAP</span>
            </div>
            
            <button class="plus-btn" onclick="openPopup()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
            </button>
        </div>
        
        <div class="ticker">
            <div class="ticker-metric active" onclick="switchMetric('global')">
                <span>üåç</span>
                <span id="globalPrompts">0</span>
            </div>
            <div class="ticker-metric" onclick="switchMetric('personal')">
                <span>üë§</span>
                <span id="personalPrompts">0</span>
            </div>
            <div class="ticker-metric" onclick="switchMetric('energy')">
                <span>‚ö°</span>
                <span id="energyUsage">0 kWh</span>
            </div>
        </div>
    </div>
    
    <!-- Main Chat Area -->
    <div class="chat-container">
        <div class="chat-messages" id="chatMessages">
            <div class="message ai">
                <div class="message-content">
                    Hello! I'm your sustainable AI assistant. I can help you understand environmental impact, answer questions about sustainability, and track the carbon footprint of our conversation.
                </div>
                <div class="message-time">Just now</div>
            </div>
        </div>
        
        <div class="chat-input-container">
            <textarea 
                class="chat-input" 
                id="chatInput" 
                placeholder="Ask me anything about sustainability..."
                rows="1"
            ></textarea>
            <button class="send-btn" id="sendBtn" onclick="sendMessage()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
                </svg>
            </button>
        </div>
    </div>
    
    <!-- Footer -->
    <div class="footer">
        <div class="footer-content">
            <a href="#" class="footer-link">About SAP</a>
            <a href="#" class="footer-link">Privacy</a>
            <a href="#" class="footer-link">Terms</a>
            <a href="#" class="footer-link">Contact</a>
        </div>
    </div>
    
    <!-- Popup -->
    <div class="popup-overlay" id="popupOverlay">
        <div class="popup">
            <div class="popup-header">
                <h3 class="popup-title">SAP Protocol</h3>
                <button class="popup-close" onclick="closePopup()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="popup-content">
                <p>Welcome to the Sustainable AI Protocol. This is where we'll add more features and information about the mission.</p>
                <br>
                <p>For now, enjoy the clean chat experience and explore sustainability through AI.</p>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let userId = 'user_' + Math.random().toString(36).substr(2, 9);
        let currentMetric = 'global';
        let personalPrompts = 0;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadGlobalStats();
            setupChatInput();
            setupTicker();
        });
        
        // Chat functionality
        function setupChatInput() {
            const input = document.getElementById('chatInput');
            const sendBtn = document.getElementById('sendBtn');
            
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            input.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });
        }
        
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addMessage('user', message);
            input.value = '';
            input.style.height = 'auto';
            
            // Disable send button
            const sendBtn = document.getElementById('sendBtn');
            sendBtn.disabled = true;
            sendBtn.innerHTML = '<div style="width: 16px; height: 16px; border: 2px solid #fff; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>';
            
            try {
                // Generate AI response
                const response = await generateAIResponse(message);
                addMessage('ai', response);
                
                // Track the prompt
                await trackPrompt(message);
                personalPrompts++;
                updateTicker();
                
            } catch (error) {
                console.error('Error:', error);
                addMessage('ai', 'Sorry, I encountered an error. Please try again.');
            } finally {
                // Re-enable send button
                sendBtn.disabled = false;
                sendBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22,2 15,22 11,13 2,9 22,2"></polygon></svg>';
            }
        }
        
        function addMessage(sender, content) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            messageDiv.innerHTML = `
                <div class="message-content">${content}</div>
                <div class="message-time">${time}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        async function generateAIResponse(prompt) {
            // Simulate AI response for now
            const responses = [
                "That's a great question about sustainability! Let me help you understand the environmental impact.",
                "I can help you explore sustainable practices and their benefits for the environment.",
                "Sustainability is about meeting present needs without compromising future generations. What specific aspect interests you?",
                "The carbon footprint of AI is an important consideration. Let me share some insights about this topic.",
                "Environmental responsibility in technology is crucial. I'm here to help you learn more about sustainable AI practices."
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }
        
        async function trackPrompt(prompt) {
            try {
                const response = await fetch('/api/track', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt: prompt,
                        model: 'sap-chat',
                        userId: userId
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    updateGlobalStats(result.stats);
                }
            } catch (error) {
                console.error('Error tracking prompt:', error);
            }
        }
        
        // Ticker functionality
        function setupTicker() {
            // Auto-refresh every 5 seconds
            setInterval(loadGlobalStats, 5000);
        }
        
        async function loadGlobalStats() {
            try {
                const response = await fetch('/api/stats');
                if (response.ok) {
                    const stats = await response.json();
                    updateGlobalStats(stats);
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }
        
        function updateGlobalStats(stats) {
            document.getElementById('globalPrompts').textContent = stats.totalPrompts.toLocaleString();
            document.getElementById('energyUsage').textContent = stats.totalEnergy.toFixed(3) + ' kWh';
        }
        
        function updateTicker() {
            document.getElementById('personalPrompts').textContent = personalPrompts;
        }
        
        function switchMetric(metric) {
            currentMetric = metric;
            
            // Update active state
            document.querySelectorAll('.ticker-metric').forEach(el => {
                el.classList.remove('active');
            });
            event.target.closest('.ticker-metric').classList.add('active');
        }
        
        // Popup functionality
        function openPopup() {
            document.getElementById('popupOverlay').style.display = 'flex';
        }
        
        function closePopup() {
            document.getElementById('popupOverlay').style.display = 'none';
        }
        
        // Sidebar functionality
        function toggleSidebar() {
            // Placeholder for sidebar functionality
            console.log('Toggle sidebar');
        }
        
        // Close popup when clicking overlay
        document.getElementById('popupOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                closePopup();
            }
        });
    </script>
    
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</body>
</html>
